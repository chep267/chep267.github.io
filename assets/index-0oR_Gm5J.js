import{ao as A,af as v,r as d,ap as G,j as s,ay as j,h as f,v as E,b1 as w,b2 as $,b3 as k,aw as P,n as x,u as T,F as _,b4 as U,au as z,b5 as B,b6 as O,b7 as V,b8 as K,I as q,T as Q,b9 as X,ba as Y,bb as J,l as Z,bc as ee,R as se,m as te,b0 as M}from"./vendor-NFT-wIW4.js";import{u as N,f as F,h as g,i as C,b as R,j as ne,k as ae,l as oe,m as ie,n as y,o as re,p as b,M as ce,q as le,T as de,E as ue,r as D,t as H,v as p,w as he,x as me,L as fe,y as xe,z as S,A as Ee,B as je,C as pe,F as _e,G as Se,H as L,J as Te,K as ge,N as Ie,O as W,P as be,Q as ye,R as Me,U as Ne,V as Ce,W as ve,d as h}from"./index-sNUf3CTI.js";import"./commonjsHelpers-5-cIlDoe.js";const Fe=e=>{if(!e)return!1;setTimeout(()=>{e.selectionStart=e.selectionEnd=e.value?.length,e?.focus?.()},1)};function Re(){const e=A(),t=N(),a=F(),i=t.data.me.uid,o=e.getQueryData(["useListThread",{uid:i}]);return v({mutationFn:n=>{const{tid:r}=n,c=g(r,"uid"),l=g(i,"tid");let u={...n};return o?.itemIds?.includes?.(r)&&(u={...o?.items?.[r],...u}),Promise.all([C({uid:i,tid:r,data:{type:"thread",members:[i,c],...u}}),C({uid:c,tid:l,data:{members:[i,c],...u,tid:l}})])},onError:n=>{console.log("error: ",n),a.method.toggleNotify({open:!0,mode:"error",intlMessage:R["module.base.error.server.busy"]})}})}function De({tid:e}){const t=N(),[a,i]=d.useState(ne),[o,n]=d.useState(ae),r=t.data.me.uid,c=d.useRef({unsubscribe:oe});return{...G({queryKey:["useListenListMessage",{tid:e}],queryFn:async()=>{c.current?.unsubscribe?.();const u=await ie({tid:`${e}`,uid:r,fnCallback:m=>{i(m.itemIds),n(m.items)}});return c.current.unsubscribe=u?.unsubscribe,u},enabled:!!e,refetchOnWindowFocus:!1}),data:{itemIds:a,items:o}}}function He(){const e=N(),t=F(),a=Re(),i=e.data.me.uid;return v({mutationFn:async({tid:o,draft:n})=>{const r=y({...n,tid:o,uid:i,isEncrypt:!0});if(n.fileIds.length){const c=await Promise.all(n.fileIds.map(u=>re({tid:o,mid:r.mid,fid:u,file:n.files[u]}))),l={};c?.map(u=>{u&&(l[u.fid]={...n.files[u.fid],fileData:null,url:u.url})}),r.files=l}return b({uid:i,tid:o,mid:r.mid,data:r})},onSuccess:({message:o},{tid:n})=>{if(n===ce){const r=le.random,c=r[Math.floor(Math.random()*r.length)],l=y({tid:n,uid:n,text:c,isEncrypt:!0});b({uid:i,tid:n,mid:l.mid,data:l}).then()}else{const r=g(n,"uid"),c=g(i,"tid");b({uid:r,tid:c,mid:o.mid,data:o}).then()}a.mutate({tid:n,lastMessage:o})},onError:o=>{console.log("error: ",o),t.method.toggleNotify({open:!0,mode:"error",intlMessage:R["module.base.error.server.busy"]})}})}function Le(e){const{children:t}=e,[a,i]=d.useState(!1),[o,n]=d.useState(""),[r,c]=d.useState(!1),l=d.useMemo(()=>({data:{isFocusSearch:a,isSearching:r,searchKey:o},method:{setFocusSearch:i,setSearching:c,setSearchKey:n}}),[a,r,o]);return s.jsx(de.Provider,{value:l,children:s.jsx(ue,{isAutoReload:!0,children:t})})}function We(){const e=D(),{tid:t=""}=j();return s.jsx(f,{className:e.header_left,children:s.jsx(H,{tid:t,variant:"h5"})})}function Ae(){const{method:e}=p(),t=d.useCallback(()=>{e.setOpenThreadInfo(a=>!a)},[]);return s.jsx(E,{onClick:t,children:s.jsx(w,{color:"primary"})})}function Ge(){const e=D();return s.jsxs(f,{className:e.header,children:[s.jsx(We,{}),s.jsxs(f,{className:e.header_right,children:[s.jsx(E,{children:s.jsx($,{color:"primary"})}),s.jsx(E,{children:s.jsx(k,{color:"primary"})}),s.jsx(Ae,{})]})]})}function we(){const e=he(),{tid:t=""}=j(),a=De({tid:t}),i=d.useRef(null);d.useEffect(()=>{i.current&&setTimeout(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},200)},[a.isFetching,a.data.itemIds]);const o=d.useCallback(n=>{const r=a.data.items[n];return s.jsx(P,{className:x(e.listItem),children:s.jsx(me,{data:r})},`${t}-${n}`)},[a.data.itemIds,t]);return s.jsx(fe,{listRef:i,className:x(e.body,"messenger_left_thread_list_default"),loading:a.isFetching,data:a.data.itemIds,renderItem:o})}function $e(){const{tid:e=""}=j(),t=xe(),a=He(),{ui:i,method:o}=p(),n=i.drafts[e],r=()=>{a.mutate({tid:e,draft:n},{onSuccess:()=>{o.setEmptyThread(e)},onError:()=>{o.setEmptyThread(e)}})},c=d.useCallback(()=>{a.mutate({tid:e,draft:y({tid:e,type:"emoji"})})},[e]),l=!!n?.text||!!n?.fileIds?.length;return s.jsxs(s.Fragment,{children:[s.jsx(T,{title:s.jsx(_,{...S["module.messenger.component.button.sendMessage.tooltip"]}),children:s.jsx(E,{disabled:a.isPending,onClick:r,className:x(t.btnSend,{[t.btnVisible]:l}),children:s.jsx(U,{color:"primary"})})}),s.jsx(T,{title:s.jsx(_,{...S["module.messenger.component.button.sendEmoji.tooltip"]}),children:s.jsx(E,{disabled:a.isPending,onClick:c,className:x(t.btnSend,{[t.btnVisible]:!l}),children:s.jsx(z,{color:"primary"})})})]})}function ke(e){const{onEmojiSelect:t}=e,{data:{locale:a}}=Ee(),{data:{mode:i}}=je();return s.jsx(B,{data:O,onEmojiSelect:t,locale:a,theme:i})}function Pe(){const{tid:e=""}=j(),t=pe(),{method:a}=p(),[i,o]=d.useState(null),n=d.useCallback(m=>o(m.currentTarget),[]),r=d.useCallback(()=>o(null),[]),c=!!i,l=c?"simple-popover":void 0,u=d.useCallback(m=>{!e||!m?.native||a.setText({tid:e,text:m.native,type:"emoji"})},[e]);return s.jsxs(s.Fragment,{children:[s.jsx(T,{title:s.jsx(_,{...S["module.messenger.component.button.chooseEmoji.tooltip"]}),children:s.jsx(E,{"aria-describedby":l,onClick:n,children:s.jsx(V,{color:"primary"})})}),s.jsx(K,{id:l,open:c,anchorEl:i,onClose:r,className:t.menuPaper,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(ke,{onEmojiSelect:u})})]})}function Ue(){const{tid:e=""}=j(),t=_e(),{ui:a,method:i}=p(),o=d.useRef(null),[n,r]=d.useState(""),c=e?a.drafts[e]:null;d.useEffect(()=>{c?.text!==n&&r(c?.text||""),Fe(o.current)},[e,c]),d.useEffect(()=>{e&&n!==c?.text&&i.setText({tid:e,text:n})},[n]);const l=d.useCallback(m=>{r(m.target.value)},[]),u=d.useMemo(()=>({endAdornment:s.jsx(q,{position:"end",children:s.jsx(Pe,{})})}),[]);return s.jsx(Q,{inputRef:o,className:t.input,placeholder:"Aa",size:"small",multiline:!0,maxRows:5,variant:"outlined",spellCheck:!1,fullWidth:!0,value:n,onChange:l,InputProps:u})}function ze(){const{tid:e=""}=j(),t=Se(),{method:a}=p(),i=d.useCallback(o=>{const n=o.target.files;if(!e||!n)return;const r=[],c={};for(let l=0,u=n.length;l<u;++l){const m=`fid.${window.crypto.randomUUID()}`;r.push(m),c[m]={fileData:n[l],url:"",name:n[l].name,size:n[l].size,type:n[l].type}}a.setFiles({tid:e,fileIds:r,files:c})},[e]);return s.jsx(T,{title:s.jsx(_,{...S["module.messenger.component.button.chooseFile.tooltip"]}),children:s.jsxs(E,{color:"primary",className:t.btnFile,component:"label",htmlFor:"messenge-footer-input-file",children:[s.jsx(X,{}),s.jsx("input",{accept:"image/*",className:t.inputFile,id:"messenge-footer-input-file",type:"file",multiple:!0,onChange:i})]})})}function Be(e){const{file:t,fid:a,onRemoveFile:i}=e,o=L();return t?.fileData?s.jsxs(f,{className:o.list_item,children:[s.jsx(E,{className:o.iconRemove,onClick:()=>i(a),size:"small",children:s.jsx(Y,{fontSize:"small"})}),s.jsx("img",{alt:"",src:URL.createObjectURL(t.fileData)})]}):null}function Oe(){const{tid:e=""}=j(),t=L(),{ui:a,method:i}=p(),o=e?a.drafts[e]:null,n=d.useCallback(r=>{i.removeFiles({tid:e,fileIds:[r]})},[e]);return o?.fileIds?.length?s.jsx(f,{className:t.list_wrap,children:o.fileIds.map(r=>s.jsx(Be,{file:o?.files?.[r],fid:r,onRemoveFile:n},r))}):null}function Ve(){const e=Te();return s.jsxs(f,{className:e.footer,children:[s.jsxs(f,{className:x(e.footer_left,{[e.footer_left_hidden]:!1}),children:[s.jsx(ze,{}),s.jsx(E,{onClick:()=>{},children:s.jsx(J,{color:"primary"})})]}),s.jsxs(f,{className:x(e.footer_center,{[e.footer_center_full]:!1}),children:[s.jsx(Oe,{}),s.jsx(Ue,{})]}),s.jsx(f,{className:e.footer_right,children:s.jsx($e,{})})]})}function Ke(){const e=ge();return s.jsx(f,{className:x(".ThreadTitle",e.thread_title),children:s.jsx(Z,{variant:"h5",children:s.jsx(_,{...S["module.messenger.component.thread.title"]})})})}function qe(){const e=Ie(),{data:{isFocusSearch:t},method:{setFocusSearch:a,setSearching:i,setSearchKey:o}}=W();return s.jsxs(f,{className:x(".ThreadSearch",e.inputSearch,{[e.inputSearch_blur]:!t}),children:[s.jsx(E,{onClick:()=>a(!1),children:s.jsx(ee,{})}),s.jsx(be,{onFocus:()=>a(!0),onChangeValue:o,onLoading:i})]})}function Qe(){const e=ye(),{data:{isFocusSearch:t}}=W();return s.jsxs(se,{className:x(e.thread_content,{[e.thread_content_focus_search]:t}),children:[s.jsx(Me,{}),s.jsx(Ne,{})]})}function Xe(){const e=Ce(),{tid:t=""}=j();return s.jsxs(f,{className:e.thread_info,children:[s.jsx(ve,{tid:t,className:e.avatar}),s.jsx(H,{tid:t,variant:"h6",pt:2})]})}const Ye=te(({palette:e,breakpoints:t,zIndex:a})=>({screen:{position:"relative",flexDirection:"row",width:"100%",height:"100%"},layoutDefault:{display:"flex",position:"relative",flexDirection:"column",alignItems:"center",justifyContent:"space-between",width:"100%",height:"100%",borderRadius:0,overflow:"hidden"},left:{maxWidth:h.MESSENGER_LEFT_RIGHT_MAX_WIDTH,transition:"all 0.3s ease-in-out, background-color 0s",[t.down("xl")]:{minWidth:h.MESSENGER_LEFT_MEDIUM_WIDTH,maxWidth:h.MESSENGER_LEFT_MEDIUM_WIDTH},[t.down("md")]:{minWidth:h.MESSENGER_LEFT_MIN_WIDTH,maxWidth:h.MESSENGER_LEFT_MIN_WIDTH,'& div[class*=".ThreadTitle"], div[class*=".ThreadSearch"]':{position:"absolute",zIndex:-1,visibility:"hidden"},'& li[class*=".ThreadItem"]':{"& > div:last-of-type, button":{visibility:"hidden",width:0}}},[t.down("sm")]:{minWidth:0,maxWidth:0}},right:{borderLeft:`1px solid ${e.divider}`,maxWidth:h.MESSENGER_LEFT_RIGHT_MAX_WIDTH,transition:"all 0.3s ease-in-out, height 0s, background-color 0s",[t.down("xl")]:{minWidth:h.MESSENGER_LEFT_MEDIUM_WIDTH,maxWidth:h.MESSENGER_LEFT_MEDIUM_WIDTH},[t.down("lg")]:{position:"fixed",top:h.HEADER_HEIGHT+h.MESSENGER_CENTER_HEADER_HEIGHT,right:0,zIndex:a.drawer,minWidth:h.MESSENGER_LEFT_MEDIUM_WIDTH,maxWidth:h.MESSENGER_LEFT_MEDIUM_WIDTH,maxHeight:`calc(100% - ${h.HEADER_HEIGHT+h.MESSENGER_CENTER_HEADER_HEIGHT}px)`}},center:{borderLeft:`1px solid ${e.divider}`},right_hidden:{minWidth:0,maxWidth:0,visibility:"hidden",zIndex:-1,border:"none"}}));var I=Ye;function Je(){const e=I();return s.jsxs(M,{className:x(e.layoutDefault,e.left),children:[s.jsx(Ke,{}),s.jsxs(Le,{children:[s.jsx(qe,{}),s.jsx(Qe,{})]})]})}function Ze(){const e=I();return s.jsxs(M,{className:x(e.layoutDefault,e.center),children:[s.jsx(Ge,{}),s.jsx(we,{}),s.jsx(Ve,{})]})}function es(){const e=I(),{ui:t}=p();return s.jsx(M,{className:x(e.layoutDefault,e.right,{[e.right_hidden]:!t.openThreadInfo}),children:s.jsx(Xe,{})})}function as(){const e=I();return s.jsxs(f,{className:e.screen,children:[s.jsx(Je,{}),s.jsx(Ze,{}),s.jsx(es,{})]})}export{as as default};
//# sourceMappingURL=index-0oR_Gm5J.js.map
