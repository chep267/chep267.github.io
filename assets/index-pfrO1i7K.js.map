{"version":3,"file":"index-pfrO1i7K.js","sources":["../../src/modules/module-auth/hooks/useSignIn.ts","../../src/modules/module-auth/components/SignInForm/index.tsx"],"sourcesContent":["/**\n *\n * @author dongntd267@gmail.com on 26/07/2023.\n *\n */\n\nimport Cookies from 'js-cookie';\nimport { useMutation } from '@tanstack/react-query';\nimport { useIntl } from 'react-intl';\n\n/** apis */\nimport { apiSignIn } from '@module-auth/apis';\n\n/** constants */\nimport { accessTokenCookieKey, emailLocalKey } from '@module-base/constants/localStoreKey';\n\n/** utils */\nimport { Encrypt } from '@module-base/utils/security';\nimport { localStorageBase } from '@module-base/utils/storages';\nimport { authMessage } from '@module-auth/utils/messages';\n\n/** hooks */\nimport { useBase } from '@module-base/hooks/useBase';\nimport { useAuth } from '@module-auth/hooks/useAuth';\n\nexport function useSignIn() {\n    const intl = useIntl();\n    const auth = useAuth();\n    const { notify } = useBase();\n\n    return useMutation({\n        mutationFn: apiSignIn,\n        onSuccess: async (response, { email }) => {\n            const me = response.user;\n            const accessToken = (await me.getIdToken()) || '';\n            localStorageBase.set(emailLocalKey, Encrypt(email));\n            Cookies.set(accessTokenCookieKey, accessToken, { expires: 1 });\n            auth.toggleAuth({ isAuth: true, me });\n        },\n        onError: () => {\n            notify.toggleNotify({\n                open: true,\n                mode: 'error',\n                message: intl.formatMessage(authMessage[`module.auth.form.status.email.incorrect`]),\n            });\n        },\n    });\n}\n","/**\n *\n * @author dongntd267@gmail.com on 26/07/2023.\n *\n */\n\nimport * as React from 'react';\nimport { useIntl } from 'react-intl';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { useForm, Controller } from 'react-hook-form';\n\n/** lib components */\nimport { Link } from 'react-router-dom';\nimport { Paper, Stack, Typography, TextField } from '@mui/material';\nimport { LoadingButton } from '@mui/lab';\n\n/** components */\nimport PasswordField from '@module-base/components/PasswordField';\n\n/** constants */\nimport { emailLocalKey } from '@module-base/constants/localStoreKey';\nimport { AUTH_SCREEN } from '@module-auth/constants/screen';\n\n/** utils */\nimport { Decrypt } from '@module-base/utils/security';\nimport { localStorageBase } from '@module-base/utils/storages';\nimport { authMessage } from '@module-auth/utils/messages';\nimport { authFormSchema } from '@module-auth/utils/helpers/authFormSchema';\n\n/** hooks */\nimport { useSignIn } from '@module-auth/hooks/useSignIn';\n\n/** styles */\nimport useStyles from './styles';\n\n/** types */\nimport type { AuthApiProps, FormAuthDataType } from '@module-auth/models';\n\nexport default function SignInForm() {\n    const { formatMessage } = useIntl();\n    const SIGN_IN = useSignIn();\n    const classes = useStyles();\n\n    const {\n        handleSubmit,\n        control,\n        formState: { errors },\n        setFocus,\n    } = useForm<FormAuthDataType>({\n        defaultValues: {\n            email: Decrypt(localStorageBase.get(emailLocalKey)),\n            password: '',\n        },\n        mode: 'onSubmit',\n        resolver: yupResolver(authFormSchema),\n    });\n\n    const onSubmit = React.useCallback((data: AuthApiProps['SignIn']['Payload']) => SIGN_IN.mutate(data), []);\n\n    return (\n        <>\n            <Typography variant=\"h3\" className={classes.title}>\n                {formatMessage(authMessage['module.auth.form.title.signin'])}\n            </Typography>\n\n            <Paper className={classes.form} component=\"form\" onSubmit={handleSubmit(onSubmit)} noValidate>\n                <Controller\n                    name=\"email\"\n                    control={control}\n                    render={({ field }) => {\n                        const error = Boolean(errors.email);\n                        const errorMessage = errors.email?.message as keyof typeof authMessage;\n                        return (\n                            <TextField\n                                {...field}\n                                type=\"email\"\n                                label={formatMessage(authMessage['module.auth.form.input.label.email'])}\n                                variant=\"outlined\"\n                                spellCheck={false}\n                                fullWidth\n                                autoComplete=\"email\"\n                                autoFocus // eslint-disable-line jsx-a11y/no-autofocus\n                                error={error}\n                                helperText={errorMessage && formatMessage(authMessage[errorMessage])}\n                            />\n                        );\n                    }}\n                />\n                <Controller\n                    name=\"password\"\n                    control={control}\n                    render={({ field: { ref, ...field } }) => {\n                        const error = Boolean(errors.password);\n                        const errorMessage = errors.password?.message as keyof typeof authMessage;\n                        return (\n                            <PasswordField\n                                {...field}\n                                inputRef={ref}\n                                label={formatMessage(authMessage['module.auth.form.input.label.password'])}\n                                variant=\"outlined\"\n                                spellCheck={false}\n                                fullWidth\n                                autoComplete=\"password\"\n                                error={error}\n                                helperText={errorMessage && formatMessage(authMessage[errorMessage])}\n                                setFocus={() => setFocus('password')}\n                            />\n                        );\n                    }}\n                />\n\n                <Stack className={classes.link}>\n                    <Link to={AUTH_SCREEN.REGISTER} replace>\n                        {formatMessage(authMessage['module.auth.form.title.register'])}\n                    </Link>\n                    <Typography variant=\"h6\" color=\"primary.main\">\n                        &nbsp;/&nbsp;\n                    </Typography>\n                    <Link to={AUTH_SCREEN.RECOVER} replace>\n                        {formatMessage(authMessage['module.auth.form.title.recover'])}\n                    </Link>\n                </Stack>\n\n                <LoadingButton\n                    type=\"submit\"\n                    loading={SIGN_IN.isPending}\n                    size=\"large\"\n                    variant=\"contained\"\n                    fullWidth\n                    className={classes.btnSubmit}>\n                    {formatMessage(authMessage['module.auth.form.button.submit.signin'])}\n                </LoadingButton>\n            </Paper>\n        </>\n    );\n}\n"],"names":["useSignIn","intl","useIntl","auth","useAuth","notify","useBase","useMutation","mutationFn","apiSignIn","onSuccess","response","email","me","user","accessToken","getIdToken","localStorageBase","set","emailLocalKey","Encrypt","accessTokenCookieKey","expires","toggleAuth","isAuth","onError","toggleNotify","open","mode","message","formatMessage","authMessage","SignInForm","SIGN_IN","classes","useStyles","handleSubmit","control","formState","errors","setFocus","useForm","defaultValues","Decrypt","get","password","resolver","yupResolver","authFormSchema","onSubmit","React","useCallback","data","mutate","jsxs","Fragment","jsx","Typography","title","Paper","form","Controller","field","error","Boolean","errorMessage","TextField","ref","PasswordField","Stack","link","Link","AUTH_SCREEN","REGISTER","RECOVER","LoadingButton","isPending","btnSubmit"],"mappings":"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"}